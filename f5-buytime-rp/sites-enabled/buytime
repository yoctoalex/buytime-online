server {
	server_name _;
	listen 80 ;
	access_log /var/log/nginx/access.log vhost;

	client_max_body_size 100M;
	client_body_buffer_size     32k;
	client_header_buffer_size   8k;
	large_client_header_buffers 4 32k;

    location ~* \.(jpg|jpeg|png|gif|ico|css|js|woff2|svg)$ {
        proxy_cache STATIC;

        expires 1d;
        proxy_ignore_headers        Cache-Control;
        proxy_cache_valid any       10m;
        proxy_cache_use_stale       error timeout http_500 http_502 http_503 http_504;

        proxy_set_header    X-Real-IP $remote_addr;
        proxy_set_header    Host      $http_host;

        add_header X-Cache-Status $upstream_cache_status;

        proxy_http_version 1.1;
        proxy_set_header Connection "";

        proxy_pass http://frontend;
    }

#    location ^~ /api/v2 {
#        proxy_cache STATIC;
#
#        expires 1d;
#        proxy_ignore_headers        Cache-Control;
#        proxy_cache_valid any       10m;
#        proxy_cache_use_stale       error timeout http_500 http_502 http_503 http_504;
#
#        proxy_set_header    X-Real-IP $remote_addr;
#        proxy_set_header    Host      $http_host;
#
#        add_header X-Cache-Status $upstream_cache_status;
#
#        proxy_http_version 1.1;
#        proxy_set_header Connection "";
#		proxy_pass http://find-a-store:9339;
#	}

    location ^~ /api/v1 {
        proxy_cache STATIC;

        expires 1d;
        proxy_ignore_headers        Cache-Control;
        proxy_cache_valid any       10m;
        proxy_cache_use_stale       error timeout http_500 http_502 http_503 http_504;

        proxy_set_header    X-Real-IP $remote_addr;
        proxy_set_header    Host      $http_host;

        add_header X-Cache-Status $upstream_cache_status;

        proxy_http_version 1.1;
        proxy_set_header Connection "";

		proxy_pass http://backend;
	}

	location / {
        proxy_http_version 1.1;
        proxy_set_header Connection "";
		proxy_pass http://frontend;
	}
}