FROM node:11.15 AS builder

COPY ./f5-buytime-online-frontend/ /var/www/

ARG REACT_APP_META
ENV REACT_APP_META $REACT_APP_META
ARG REACT_APP_TITLE
ENV REACT_APP_TITLE $REACT_APP_TITLE
ARG REACT_APP_FAVICON
ARG REACT_APP_COUNTRY_FLAG
ENV REACT_APP_COUNTRY_FLAG $REACT_APP_COUNTRY_FLAG
RUN cp -rf /var/www/public/$REACT_APP_FAVICON /var/www/public/favicon.ico
ARG REACT_APP_MAP_BG
ENV REACT_APP_MAP_BG $REACT_APP_MAP_BG
ARG REACT_APP_META_FROM_URL
ENV REACT_APP_META_FROM_URL $REACT_APP_META_FROM_URL
ARG REACT_APP_GEO_LOCATION_NEAREST_STORE
ENV REACT_APP_GEO_LOCATION_NEAREST_STORE $REACT_APP_GEO_LOCATION_NEAREST_STORE
ARG REACT_APP_GEO_LOCATION_USER_ZIPSTORES
ENV REACT_APP_GEO_LOCATION_USER_ZIPSTORES $REACT_APP_GEO_LOCATION_USER_ZIPSTORES
ARG REACT_APP_GEO_LOCATION_ZIP_INFO
ENV REACT_APP_GEO_LOCATION_ZIP_INFO $REACT_APP_GEO_LOCATION_ZIP_INFO
ARG REACT_APP_NO_NEAREST_STORE
ENV REACT_APP_NO_NEAREST_STORE $REACT_APP_NO_NEAREST_STORE

WORKDIR /var/www
RUN npm install
RUN npm run build

FROM node:14-buster
RUN mkdir /var/dependencies/
COPY ./f5-auction-frontend-server/package.json /var/dependencies/
COPY ./f5-auction-frontend-server/ /var/www/
WORKDIR /var/dependencies/

RUN npm install
ENV NODE_PATH=/var/dependencies/node_modules
ENV PATH="/var/dependencies/node_modules/.bin:${PATH}"

COPY --from=builder /var/www/build /var/www/public/build

WORKDIR /var/www
CMD ["npm", "start"]
